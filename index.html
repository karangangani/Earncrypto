<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>AETHER â€” Premium Mining</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.css"/>
<script src='//libtl.com/sdk.js' data-zone='10192178' data-sdk='show_10192178'></script>

<style>
:root { 
  --bg: #05070a; 
  --card: #0d1117; 
  --accent: #10b981; /* Emerald */
  --text: #ffffff; 
  --muted: #8b949e; 
  --border: rgba(16, 185, 129, 0.2);
  --glow: 0 0 15px rgba(16, 185, 129, 0.4);
}

* { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
body { background: var(--bg); color: var(--text); min-height: 100vh; padding: 15px; }

/* Header Styling */
.header { display: flex; align-items: center; justify-content: space-between; padding: 15px; background: var(--card); border-radius: 20px; border: 1px solid var(--border); margin-bottom: 20px; box-shadow: var(--glow); }
.logo-box { display: flex; align-items: center; gap: 10px; }
.logo-circle { width: 45px; height: 45px; background: var(--accent); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: 900; color: #000; box-shadow: var(--glow); }
.user-info h2 { font-size: 16px; margin: 0; }
.user-info p { font-size: 11px; color: var(--muted); }

/* Main Stats */
.main-balance { text-align: center; padding: 30px 10px; }
.main-balance h1 { font-size: 48px; font-weight: 800; color: var(--accent); text-shadow: var(--glow); }
.main-balance p { color: var(--muted); font-size: 14px; text-transform: uppercase; letter-spacing: 2px; }

.stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
.stat-item { background: var(--card); padding: 15px; border-radius: 15px; border: 1px solid var(--border); text-align: center; }
.stat-item span { display: block; font-size: 11px; color: var(--muted); margin-bottom: 5px; }
.stat-item b { font-size: 18px; color: var(--text); }

/* Tabs Navigation */
.nav-bar { display: flex; background: var(--card); padding: 5px; border-radius: 15px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.05); }
.nav-item { flex: 1; padding: 12px; text-align: center; font-size: 13px; font-weight: 600; color: var(--muted); cursor: pointer; border-radius: 12px; transition: 0.3s; }
.nav-item.active { background: var(--accent); color: #000; box-shadow: var(--glow); }

.page { display: none; animation: slideUp 0.4s ease-out; }
.page.active { display: block; }
@keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

/* Buttons */
.btn { width: 100%; padding: 16px; border-radius: 16px; border: none; background: var(--accent); color: #000; font-weight: 800; cursor: pointer; margin-top: 10px; font-size: 15px; transition: 0.3s; }
.btn:active { transform: scale(0.98); }
.btn.mining-on { background: #1f2937; color: var(--accent); border: 1px solid var(--accent); }

/* Mining Animation */
.mining-circle { width: 120px; height: 120px; margin: 20px auto; border: 4px solid var(--border); border-top: 4px solid var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; position: relative; }
.mining-active { animation: spin 2s linear infinite; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

/* Alerts/Notifications */
#toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: #fff; color: #000; padding: 10px 20px; border-radius: 10px; font-weight: 700; font-size: 14px; display: none; z-index: 9999; }
</style>
</head>
<body>

<div id="toast">Message</div>

<div class="header">
  <div class="logo-box">
    <div class="logo-circle">AE</div>
    <div class="user-info">
      <h2 id="u-name">Loading...</h2>
      <p id="u-id">Syncing with AetherBot...</p>
    </div>
  </div>
  <div id="ton-btn"></div>
</div>

<div class="nav-bar">
  <div class="nav-item active" onclick="showPage('home', this)">Mining</div>
  <div class="nav-item" onclick="showPage('earn', this)">Earn</div>
  <div class="nav-item" onclick="showPage('invite', this)">Invite</div>
  <div class="nav-item" onclick="showPage('airdrop', this)">Airdrop</div>
</div>

<div id="home" class="page active">
  <div class="main-balance">
    <p>Available Balance</p>
    <h1 id="b-coins">0.00</h1>
  </div>

  <div class="mining-circle" id="m-spinner">
    <span style="font-weight: 900; color: var(--accent)">AETHER</span>
  </div>

  <button id="mine-btn" class="btn" onclick="toggleMining()">START MINING</button>
  <p style="text-align: center; font-size: 12px; margin-top: 15px; color: var(--muted);">Earns 0.5 coins/sec â€¢ Auto-Sync</p>
</div>

<div id="earn" class="page">
  <div class="stat-item" style="margin-bottom:15px;">
    <span>Level Status</span>
    <b id="u-level">Level 1</b>
  </div>
  
  <button class="btn" id="ad-btn" onclick="playAd()">WATCH AD (+500 Coins)</button>
  <p style="text-align: center; font-size: 11px; margin-top: 10px;">Cooldown: 15 mins | Total Ads: <span id="u-ads">0</span></p>

  <h3 style="margin: 25px 0 15px; color: var(--accent);">Level Up Rewards</h3>
  <div id="levels-list" style="display: flex; flex-direction: column; gap: 10px;">
    </div>
</div>

<div id="invite" class="page">
  <div class="stat-item" style="margin-bottom:20px;">
    <span>Total Referrals</span>
    <b id="u-refs">0 Friends</b>
  </div>

  <div style="background:var(--card); padding:20px; border-radius:15px; border:1px dashed var(--accent); text-align:center;">
    <h3 style="color:var(--accent)">Invite & Earn</h3>
    <p style="font-size:12px; margin: 10px 0;">+5000 Coins per valid referral</p>
    <div id="ref-link" style="background:#000; padding:10px; border-radius:8px; font-size:11px; color:var(--accent); margin:15px 0; word-break:break-all;">Generating link...</div>
    <button class="btn" onclick="copyRef()">COPY REFERRAL LINK</button>
  </div>
</div>

<div id="airdrop" class="page">
  <div style="text-align:center; padding: 40px 10px;">
    <div id="eligibility-icon" style="font-size: 50px; margin-bottom: 20px;">ðŸ”’</div>
    <h2 id="air-status">Not Eligible</h2>
    <p id="air-desc" style="color:var(--muted); font-size: 13px; margin: 10px 0 20px;">You must reach Level 3 and connect your TON wallet to be eligible for the upcoming AETHER token launch.</p>
    
    <div id="wallet-info" style="margin-top:20px; font-size:12px;"></div>
  </div>
</div>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyBRMiyuGkjDFfZE9tqgzGVWJalw_6Cypz4",
  authDomain: "earncryptomp.firebaseapp.com",
  projectId: "earncryptomp",
  storageBucket: "earncryptomp.firebasestorage.app",
  messagingSenderId: "405204250643",
  appId: "1:405204250643:web:8841299bceb46f6752cfe6"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const tg = window.Telegram.WebApp;
tg.ready();
tg.expand();

// User Data State
const tgUser = tg.initDataUnsafe.user || { id: 12345, first_name: "Developer" };
const uid = tgUser.id.toString();
let data = { coins: 0, totalAds: 0, refs: [], lastMiningTime: Date.now(), isMining: false, level: 1, claimedLevels: [], tonWallet: '' };

// Initialize App
async function init() {
  document.getElementById('u-name').innerText = tgUser.first_name;
  document.getElementById('u-id').innerText = "ID: " + uid;
  document.getElementById('ref-link').innerText = "https://t.me/AetherMineXBot?start=ref_" + uid;

  // Real-time Database Sync
  db.collection("users").doc(uid).onSnapshot((doc) => {
    if (doc.exists) {
      data = { ...data, ...doc.data() };
      calculateOfflineEarnings();
      updateUI();
    } else {
      // Create new user if not exists
      db.collection("users").doc(uid).set(data);
    }
  });

  // TON Connect Init
  const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
    manifestUrl: 'https://karangangani.github.io/Earncrypto/tonconnect-manifest.json',
    buttonRootId: 'ton-btn'
  });

  tonConnectUI.onStatusChange(wallet => {
    const addr = wallet ? wallet.account.address : '';
    db.collection("users").doc(uid).update({ tonWallet: addr });
  });

  renderLevels();
}

function updateUI() {
  document.getElementById('b-coins').innerText = data.coins.toFixed(2);
  document.getElementById('u-ads').innerText = data.totalAds;
  document.getElementById('u-refs').innerText = (data.refs?.length || 0) + " Friends";
  
  // Level Calculation
  const calculatedLevel = Math.min((data.refs?.length || 0), data.totalAds) + 1;
  document.getElementById('u-level').innerText = "Level " + calculatedLevel;
  
  // Mining Button State
  const mBtn = document.getElementById('mine-btn');
  const spinner = document.getElementById('m-spinner');
  if (data.isMining) {
    mBtn.innerText = "MINING ACTIVE...";
    mBtn.classList.add('mining-on');
    spinner.classList.add('mining-active');
  } else {
    mBtn.innerText = "START MINING";
    mBtn.classList.remove('mining-on');
    spinner.classList.remove('mining-active');
  }

  // Airdrop Logic
  const airStatus = document.getElementById('air-status');
  const airIcon = document.getElementById('eligibility-icon');
  if (calculatedLevel >= 3 && data.tonWallet) {
    airStatus.innerText = "Eligible âœ…";
    airStatus.style.color = "var(--accent)";
    airIcon.innerText = "ðŸš€";
  }
}

// Mining Logic
function toggleMining() {
  const newState = !data.isMining;
  db.collection("users").doc(uid).update({ 
    isMining: newState,
    lastMiningTime: Date.now()
  });
  showToast(newState ? "Mining Started!" : "Mining Stopped!");
}

function calculateOfflineEarnings() {
  if (data.isMining) {
    const now = Date.now();
    const diff = (now - data.lastMiningTime) / 1000; // seconds
    if (diff > 5) {
      const earned = diff * 0.5; // 0.5 coins per second
      db.collection("users").doc(uid).update({
        coins: firebase.firestore.FieldValue.increment(earned),
        lastMiningTime: now
      });
    }
  }
}

// Ads Logic
function playAd() {
  const btn = document.getElementById('ad-btn');
  btn.disabled = true;
  
  if (typeof show_10192178 === 'function') {
    show_10192178().then(() => {
      db.collection("users").doc(uid).update({
        coins: firebase.firestore.FieldValue.increment(500),
        totalAds: firebase.firestore.FieldValue.increment(1)
      });
      showToast("Reward Received! +500 Coins");
    }).catch(err => {
      showToast("Ad failed to load. Try again.");
    }).finally(() => {
      setTimeout(() => { btn.disabled = false; }, 2000);
    });
  } else {
    showToast("Ad SDK not ready.");
    btn.disabled = false;
  }
}

// UI Helpers
function showPage(pageId, el) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById(pageId).classList.add('active');
  el.classList.add('active');
}

function renderLevels() {
  const container = document.getElementById('levels-list');
  for (let i = 1; i <= 10; i++) {
    const div = document.createElement('div');
    div.className = 'stat-item';
    div.style.textAlign = 'left';
    div.innerHTML = `
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div>
          <b>Level ${i} Reward</b>
          <span style="font-size:10px;">Req: ${i} Refs & ${i} Ads</span>
        </div>
        <button class="btn" style="width:80px; padding:8px; font-size:12px;" onclick="claimLevel(${i})">Claim</button>
      </div>
    `;
    container.appendChild(div);
  }
}

function copyRef() {
  const link = document.getElementById('ref-link').innerText;
  navigator.clipboard.writeText(link);
  showToast("Link Copied!");
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.innerText = msg;
  t.style.display = 'block';
  setTimeout(() => { t.style.display = 'none'; }, 3000);
}

// Background sync loop
setInterval(calculateOfflineEarnings, 5000);

init();
</script>
</body>
    </html>
