<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AetherMine</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <!-- Ads SDK -->
  <script src='//libtl.com/sdk.js' data-zone='10192178' data-sdk='show_10192178'></script>
  <!-- Particles.js -->
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <style>
    :root {
      --bg: #0a0a0a; --card: #111; --btn: #ff6b00; --text: #fff; --accent: #ff8c33; --gold: #ffd700;
      --glow: 0 0 15px rgba(255, 107, 0, 0.6);
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); overflow: hidden; }
    #particles-js { position: absolute; width: 100%; height: 100%; z-index: 0; }
    .container { position: relative; z-index: 1; padding:15px; }

    /* Header */
    .header {
      text-align:center; padding:20px; background:linear-gradient(135deg, #ff6b00, #ff8c33);
      border-radius:16px; margin-bottom:15px; box-shadow: var(--glow);
      animation: pulse 2s infinite;
    }
    @keyframes pulse { 0%,100% { box-shadow: var(--glow); } 50% { box-shadow: 0 0 25px rgba(255, 107, 0, 0.8); } }
    .logo { width:80px; filter: drop-shadow(0 0 10px #ff6b00); animation: float 3s infinite; }
    @keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

    .airdrop {
      background:#ff4500; color:white; padding:10px; border-radius:12px; text-align:center; font-weight:bold; margin:10px 0;
      animation: bounce 1.5s infinite;
    }
    @keyframes bounce { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

    /* Stats */
    .stats {
      display:flex; justify-content:space-around; background:var(--card); padding:15px; border-radius:12px; margin:15px 0;
      box-shadow: 0 0 15px rgba(255, 107, 0, 0.3);
    }
    .stat {
      text-align:center; transition: all 0.3s;
    }
    .stat:hover { transform: scale(1.1); }
    .stat-value { font-size:22px; font-weight:bold; color:#ff6b00; text-shadow: 0 0 8px #ff6b00; }

    /* Buttons */
    .btn {
      background:var(--btn); color:#000; padding:14px; border:none; border-radius:10px; width:100%; margin:10px 0;
      font-weight:bold; font-size:16px; cursor:pointer; transition: all 0.3s;
      box-shadow: 0 0 15px rgba(255, 107, 0, 0.5);
    }
    .btn:hover { transform: translateY(-3px); box-shadow: 0 0 20px rgba(255, 107, 0, 0.8); }
    .btn:active { transform: scale(0.98); }
    .btn:disabled { background:#444; box-shadow:none; }

    /* Tabs */
    .tab {
      flex:1; text-align:center; padding:12px; background:#222; border-radius:10px; margin:0 3px; color:#ccc;
      transition: all 0.3s; cursor:pointer;
    }
    .tab.active, .tab:hover {
      background:var(--btn); color:#000; transform: scale(1.05); box-shadow: var(--glow);
    }

    /* Sections */
    .section {
      display:none; padding:15px; background:var(--card); border-radius:12px; margin:10px 0;
      box-shadow: 0 0 10px rgba(0,0,0,0.5); animation: fadeIn 0.5s;
    }
    .section.active { display:block; }
    @keyframes fadeIn { from { opacity:0; transform: translateY(10px); } to { opacity:1; transform: translateY(0); } }

    .countdown {
      text-align:center; margin:15px 0; font-size:18px; color:#ff6b00; font-weight:bold;
      text-shadow: 0 0 10px #ff6b00;
    }

    /* Leaderboard */
    .leaderboard {
      max-height:300px; overflow-y:auto; border:1px solid #333; border-radius:10px; padding:10px;
    }
    .leader {
      display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #333;
      transition: all 0.2s;
    }
    .leader:hover { background:#222; transform: translateX(5px); }
    .rank { color:#ff8c33; font-weight:bold; }

    /* Mining Animation */
    .mining-effect {
      position: absolute; top: 50%; left: 50%; width: 100px; height: 100px;
      background: radial-gradient(circle, #ff6b00, transparent); border-radius: 50%;
      transform: translate(-50%, -50%); opacity: 0; pointer-events: none;
      animation: ripple 1s infinite;
    }
    @keyframes ripple { 0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(3); opacity: 0; } }

    #ref-count { font-size:18px; color:#ff6b00; font-weight:bold; animation: pulse 1.5s infinite; }
  </style>
</head>
<body>

  <!-- Particles Background -->
  <div id="particles-js"></div>

  <div class="container">

    <!-- Header -->
    <div class="header">
      <img src="https://i.ibb.co/5jW3vYk/aethermine-logo.png" class="logo" alt="AetherMine">
      <h1>AetherMine</h1>
      <p id="username">Loading...</p>
      <div class="airdrop">
        <b>Final Airdrop</b><br>1 Jan 2026
      </div>
    </div>

    <!-- Countdown -->
    <div class="countdown" id="countdown"></div>

    <!-- Stats -->
    <div class="stats">
      <div class="stat">
        <div class="stat-value" id="points">0</div>
        <small>Points</small>
      </div>
      <div class="stat">
        <div class="stat-value" id="speed">1</div>
        <small>pts/sec</small>
      </div>
      <div class="stat">
        <div class="stat-value" id="refs">0</div>
        <small>Referrals</small>
      </div>
    </div>

    <!-- Tabs -->
    <div style="display:flex; margin:15px 0;">
      <div class="tab active" onclick="openTab('home')">Home</div>
      <div class="tab" onclick="openTab('tasks')">Tasks</div>
      <div class="tab" onclick="openTab('frens')">Frens</div>
      <div class="tab" onclick="openTab('airdrop')">Airdrop</div>
    </div>

    <!-- Home -->
    <div id="home" class="section active">
      <button class="btn" id="start-mining" onclick="startMining()">Start Mining</button>
      <div style="text-align:center; margin:15px 0;">
        <p>Daily Bonus: Day <span id="day">1</span> â†’ <span id="bonus">100</span> Points</p>
      </div>
    </div>

    <!-- Tasks -->
    <div id="tasks" class="section">
      <button class="btn" id="watch-ad">Watch Ad (+10 Speed)</button>
      <p style="text-align:center;">Daily: <span id="ads-today">0</span> / <span id="ads-limit">100</span></p>
      <button class="btn" id="join-channel">Join Channel = 2000 Points</button>
    </div>

    <!-- Frens -->
    <div id="frens" class="section">
      <p style="text-align:center; font-size:18px;">You have <span id="ref-count">0</span> Referrals</p>
      <button class="btn" onclick="shareRef()">Invite Friend (+100 Points)</button>
      <p style="font-size:12px; word-break:break-all; margin:10px 0;" id="ref-link">Loading...</p>
      <h3 style="margin:15px 0 10px; color:#ff8c33;">Top 100 Miners</h3>
      <div class="leaderboard" id="leaderboard">Loading...</div>
    </div>

    <!-- Airdrop -->
    <div id="airdrop" class="section">
      <p><b>Eligibility:</b> 10 Referrals + 5000 Points</p>
      <button class="btn" id="connect-wallet">Connect Wallet</button>
      <p id="wallet-status">Not Connected</p>
    </div>

  </div>

  <script>
    // === PARTICLES.JS ===
    particlesJS('particles-js', {
      particles: {
        number: { value: 80, density: { enable: true, value_area: 800 } },
        color: { value: '#ff6b00' },
        shape: { type: 'circle' },
        opacity: { value: 0.6, random: true },
        size: { value: 3, random: true },
        line_linked: { enable: true, distance: 150, color: '#ff8c33', opacity: 0.4, width: 1 },
        move: { enable: true, speed: 2, direction: 'none', random: false, straight: false, out_mode: 'out', bounce: false }
      },
      interactivity: {
        detect_on: 'canvas',
        events: { onhover: { enable: true, mode: 'repulse' }, onclick: { enable: true, mode: 'push' }, resize: true },
        modes: { repulse: { distance: 100, duration: 0.4 }, push: { particles_nb: 4 } }
      },
      retina_detect: true
    });

    // === MINING EFFECT ===
    function startMining() {
      if (mining) return;
      mining = true;
      const effect = document.createElement('div');
      effect.className = 'mining-effect';
      document.body.appendChild(effect);
      setTimeout(() => effect.remove(), 1000);

      setInterval(async () => {
        current.points += current.speed;
        await db.collection('users').doc(userId).update({ points: current.points });
        document.getElementById('points').innerText = Math.floor(current.points);
        // Small ripple on mining
        const ripple = document.createElement('div');
        ripple.style.cssText = `position:absolute; top:50%; left:50%; width:60px; height:60px; border:2px solid #ff6b00; border-radius:50%; transform:translate(-50%,-50%) scale(0); animation:ripple 0.6s linear;`;
        document.body.appendChild(ripple);
        setTimeout(() => ripple.remove(), 600);
      }, 1000);
    }

    // === REST OF CODE (Same as before with minor tweaks) ===
    const firebaseConfig = { /* same */ };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const tg = window.Telegram.WebApp;
    tg.ready();
    const user = tg.initDataUnsafe.user;
    const userId = user?.id?.toString() || 'anonymous';
    const username = user?.username ? `@${user.username}` : (user?.first_name || 'User');
    let current = { points: 0, speed: 1, adsToday: 0, refs: [], wallet: "", lastLogin: null, streak: 0, joinedChannel: false };
    let mining = false;

    // [All previous logic: initUser, daily bonus, ads, referral, leaderboard, etc.]

    // === INIT ===
    async function initUser() { /* same */ }
    // ... [rest of functions]

    initUser();
  </script>
</body>
</html>
