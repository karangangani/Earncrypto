<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AetherMine</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <!-- Ads SDK -->
  <script src='//libtl.com/sdk.js' data-zone='10192178' data-sdk='show_10192178'></script>
  <!-- Particles.js -->
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <style>
    :root {
      --bg: #0a0a0a; --card: #111; --btn: #00ff88; --text: #fff; --accent: #00cc66; --glow: 0 0 15px rgba(0, 255, 136, 0.6);
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); overflow: hidden; }
    #particles-js { position: absolute; width: 100%; height: 100%; z-index: 0; opacity: 0.6; }

    .container { position: relative; z-index: 1; padding:15px; }

    .header {
      text-align:center; padding:20px; background:linear-gradient(135deg, #00ff88, #00cc66);
      border-radius:16px; margin-bottom:15px; box-shadow: var(--glow);
      animation: pulse 2s infinite;
    }
    @keyframes pulse { 0%,100% { box-shadow: var(--glow); } 50% { box-shadow: 0 0 30px rgba(0, 255, 136, 0.9); } }
    .logo { width:80px; filter: drop-shadow(0 0 10px #00ff88); animation: float 3s infinite; }
    @keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

    .airdrop {
      background:#006400; color:white; padding:10px; border-radius:12px; text-align:center; font-weight:bold; margin:10px 0;
      animation: bounce 1.5s infinite;
    }
    @keyframes bounce { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

    .stats {
      display:flex; justify-content:space-around; background:var(--card); padding:15px; border-radius:12px; margin:15px 0;
      box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
    }
    .stat { text-align:center; transition: all 0.3s; }
    .stat:hover { transform: scale(1.1); }
    .stat-value { font-size:22px; font-weight:bold; color:#00ff88; text-shadow: 0 0 8px #00ff88; }

    .btn {
      background:var(--btn); color:#000; padding:14px; border:none; border-radius:10px; width:100%; margin:10px 0;
      font-weight:bold; font-size:16px; cursor:pointer; transition: all 0.3s;
      box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
    }
    .btn:hover { transform: translateY(-3px); box-shadow: 0 0 25px rgba(0, 255, 136, 0.8); }
    .btn:active { transform: scale(0.98); }
    .btn:disabled { background:#444; box-shadow:none; }

    .tab {
      flex:1; text-align:center; padding:12px; background:#222; border-radius:10px; margin:0 3px; color:#ccc;
      transition: all 0.3s; cursor:pointer;
    }
    .tab.active, .tab:hover {
      background:var(--btn); color:#000; transform: scale(1.05); box-shadow: var(--glow);
    }

    .section {
      display:none; padding:15px; background:var(--card); border-radius:12px; margin:10px 0;
      box-shadow: 0 0 10px rgba(0,0,0,0.5); animation: fadeIn 0.5s;
    }
    .section.active { display:block; }
    @keyframes fadeIn { from { opacity:0; transform: translateY(10px); } to { opacity:1; transform: translateY(0); } }

    .countdown {
      text-align:center; margin:15px 0; font-size:18px; color:#00ff88; font-weight:bold;
      text-shadow: 0 0 10px #00ff88;
    }

    .leaderboard {
      max-height:300px; overflow-y:auto; border:1px solid #333; border-radius:10px; padding:10px;
    }
    .leader {
      display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #333;
      transition: all 0.2s;
    }
    .leader:hover { background:#222; transform: translateX(5px); }
    .rank { color:#00cc66; font-weight:bold; }

    #ref-count { font-size:18px; color:#00ff88; font-weight:bold; animation: pulse 1.5s infinite; }

    .copy-btn {
      background: #00cc66; color: white; border: none; padding: 8px; border-radius: 6px; margin-top: 5px; font-size: 12px;
    }
  </style>
</head>
<body>

  <!-- Particles -->
  <div id="particles-js"></div>

  <div class="container">

    <!-- Header -->
    <div class="header">
      <img src="https://i.ibb.co.com/8x9n6Yk/ather-logo.png" class="logo" alt="AetherMine">
      <h1>AetherMine</h1>
      <p id="username">Loading...</p>
      <div class="airdrop">
        <b>Final Airdrop</b><br>1 Jan 2026
      </div>
    </div>

    <!-- Countdown -->
    <div class="countdown" id="countdown">Loading...</div>

    <!-- Stats -->
    <div class="stats">
      <div class="stat">
        <div class="stat-value" id="points">0</div>
        <small>Points</small>
      </div>
      <div class="stat">
        <div class="stat-value" id="speed">1</div>
        <small>pts/sec</small>
      </div>
      <div class="stat">
        <div class="stat-value" id="refs">0</div>
        <small>Referrals</small>
      </div>
    </div>

    <!-- Tabs -->
    <div style="display:flex; margin:15px 0;">
      <div class="tab active" onclick="openTab('home')">Home</div>
      <div class="tab" onclick="openTab('tasks')">Tasks</div>
      <div class="tab" onclick="openTab('referral')">Referral</div>
      <div class="tab" onclick="openTab('airdrop')">Airdrop</div>
    </div>

    <!-- Home -->
    <div id="home" class="section active">
      <button class="btn" id="start-mining">Start Mining</button>
      <div style="text-align:center; margin:15px 0;">
        <p>Daily Bonus: Day <span id="day">1</span> â†’ <span id="bonus">100</span> Points</p>
      </div>
    </div>

    <!-- Tasks -->
    <div id="tasks" class="section">
      <button class="btn" id="watch-ad">Watch Ad (+50 Points)</button>
      <p style="text-align:center;">Daily: <span id="ads-today">0</span> / <span id="ads-limit">100</span></p>
      <p style="color:#00ff88; font-weight:bold;">10 Ads = +500 | 20 Ads = +1000</p>
      <button class="btn" id="join-channel">Join @AetherMineX = 2000 Points</button>
    </div>

    <!-- Referral -->
    <div id="referral" class="section">
      <p style="text-align:center; font-size:18px;">You have <span id="ref-count">0</span> Referrals</p>
      <button class="btn" onclick="shareRef()">Invite Friend (+500 Points)</button>
      <p style="font-size:12px; word-break:break-all; margin:10px 0; color:#00cc66;" id="ref-link">Loading...</p>
      <button class="copy-btn" onclick="copyRef()">Copy Link</button>
      <h3 style="margin:15px 0 10px; color:#00cc66;">Top 100 Miners</h3>
      <div class="leaderboard" id="leaderboard">Loading...</div>
    </div>

    <!-- Airdrop -->
    <div id="airdrop" class="section">
      <p><b>Eligibility:</b> 10 Referrals + 5000 Points</p>
      <button class="btn" id="connect-wallet">Connect Wallet (MetaMask)</button>
      <p id="wallet-status" style="margin-top:10px; color:#00ff88;">Not Connected</p>
    </div>

  </div>

  <script>
    // === PARTICLES ===
    particlesJS('particles-js', {
      particles: { number: { value: 80 }, color: { value: '#00ff88' }, shape: { type: 'circle' }, opacity: { value: 0.6 }, size: { value: 3 }, line_linked: { enable: true, color: '#00cc66', opacity: 0.4 }, move: { enable: true, speed: 2 } },
      interactivity: { events: { onhover: { enable: true, mode: 'repulse' } } },
      retina_detect: true
    });

    // === FIREBASE ===
    const firebaseConfig = {
      apiKey: "AIzaSyBRMiyuGkjDFfZE9tqgzGVWJalw_6Cypz4",
      authDomain: "earncryptomp.firebaseapp.com",
      projectId: "earncryptomp",
      storageBucket: "earncryptomp.firebasestorage.app",
      messagingSenderId: "405204250643",
      appId: "1:405204250643:web:8841299bceb46f6752cfe6"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // === TELEGRAM ===
    const tg = window.Telegram.WebApp;
    tg.ready();
    const user = tg.initDataUnsafe.user;
    const userId = user?.id?.toString() || 'anonymous';
    const username = user?.username ? `@${user.username}` : (user?.first_name || 'User');
    let current = { points: 0, speed: 1, adsToday: 0, refs: [], wallet: "", lastLogin: null, streak: 0, joinedChannel: false, refCode: '', adsBonusClaimed: {10: false, 20: false} };

    // === INIT USER ===
    async function initUser() {
      document.getElementById('username').innerText = username;

      const doc = await db.collection('users').doc(userId).get();
      if (!doc.exists) {
        const refCode = 'AM' + Math.random().toString(36).substr(2, 6).toUpperCase();
        await db.collection('users').doc(userId).set({
          telegramId: userId, username, refCode, points: 0, speed: 1, adsToday: 0, refs: [], wallet: "", lastLogin: null, streak: 0, joinedChannel: false, adsBonusClaimed: {10: false, 20: false}, joined: new Date()
        });
        current.refCode = refCode;
      } else {
        current = doc.data();
        if (!current.adsBonusClaimed) current.adsBonusClaimed = {10: false, 20: false};
      }

      checkDailyLogin();
      updateUI();
      startCountdown();
      handleReferral();
      loadLeaderboard();
      document.getElementById('ref-link').innerText = `https://t.me/AetherMineX?start=ref_${current.refCode}`;
    }

    // === DAILY BONUS ===
    const BONUS = [100, 200, 300, 400, 500, 700, 1000];
    async function checkDailyLogin() {
      const today = new Date().toDateString();
      if (current.lastLogin !== today) {
        const streak = (current.streak % 7) + 1;
        current.points += BONUS[streak - 1];
        current.streak = streak;
        current.lastLogin = today;
        await db.collection('users').doc(userId).update({ points: current.points, streak: current.streak, lastLogin: today });
        tg.showAlert(`Day ${streak} Bonus: +${BONUS[streak-1]} Points!`);
      }
      document.getElementById('day').innerText = (current.streak % 7) + 1;
      document.getElementById('bonus').innerText = BONUS[(current.streak % 7)];
    }

    // === ADS + BONUS (10 = 500, 20 = 1000) ===
    document.getElementById('watch-ad').onclick = () => {
      const limit = 100 + current.refs.length * 2;
      if (current.adsToday >= limit) return tg.showAlert("Daily limit reached!");
      const btn = document.getElementById('watch-ad');
      btn.disabled = true; btn.innerText = "Ad Playing...";
      show_10192178().then(async () => {
        current.points += 50;
        current.adsToday += 1;

        // Bonus Check
        if (current.adsToday === 10 && !current.adsBonusClaimed[10]) {
          current.points += 500;
          current.adsBonusClaimed[10] = true;
          tg.showAlert("10 Ads Bonus: +500 Points!");
        }
        if (current.adsToday === 20 && !current.adsBonusClaimed[20]) {
          current.points += 1000;
          current.adsBonusClaimed[20] = true;
          tg.showAlert("20 Ads Bonus: +1000 Points!");
        }

        await db.collection('users').doc(userId).update({ 
          points: current.points, 
          adsToday: current.adsToday,
          adsBonusClaimed: current.adsBonusClaimed
        });
        updateUI(); 
        btn.disabled = false; 
        btn.innerText = "Watch Ad (+50 Points)";
      }).catch(() => { btn.disabled = false; btn.innerText = "Watch Ad (+50 Points)"; });
    };

    // === REFERRAL + COPY BUTTON ===
    async function handleReferral() {
      const params = new URLSearchParams(window.location.search);
      const ref = params.get('start');
      if (ref?.startsWith('ref_')) {
        const refCode = ref.split('_')[1];
        const refSnap = await db.collection('users').where('refCode', '==', refCode).get();
        if (!refSnap.empty && refSnap.docs[0].id !== userId) {
          const refId = refSnap.docs[0].id;
          await db.collection('users').doc(userId).update({ refs: firebase.firestore.FieldValue.arrayUnion(refId) });
          await db.collection('users').doc(refId).update({ points: firebase.firestore.FieldValue.increment(500) });
        }
      }
    }

    function shareRef() {
      const link = `https://t.me/AetherMineX?start=ref_${current.refCode}`;
      tg.showPopup({ message: `Share your link:\n${link}` });
    }

    function copyRef() {
      const link = `https://t.me/AetherMineX?start=ref_${current.refCode}`;
      navigator.clipboard.writeText(link).then(() => {
        tg.showAlert("Referral link copied!");
      });
    }

    // === WALLET CONNECT (FIXED) ===
    document.getElementById('connect-wallet').onclick = async () => {
      if (!window.ethereum) {
        tg.showAlert("Install MetaMask from metamask.io");
        return;
      }
      try {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        const wallet = accounts[0];
        await db.collection('users').doc(userId).update({ wallet });
        document.getElementById('wallet-status').innerText = wallet.slice(0,6) + "..." + wallet.slice(-4);
        tg.showAlert("Wallet Connected!");
      } catch (err) {
        tg.showAlert("Connection failed. Try again.");
      }
    };

    // === REST (Mining, Leaderboard, etc.) ===
    let mining = false;
    document.getElementById('start-mining').onclick = () => {
      if (mining) return;
      mining = true;
      setInterval(async () => {
        current.points += current.speed;
        await db.collection('users').doc(userId).update({ points: current.points });
        document.getElementById('points').innerText = Math.floor(current.points);
      }, 1000);
    };

    async function loadLeaderboard() {
      const snap = await db.collection('users').orderBy('points', 'desc').limit(100).get();
      const list = document.getElementById('leaderboard');
      list.innerHTML = '';
      snap.forEach((doc, i) => {
        const data = doc.data();
        list.innerHTML += `<div class="leader"><span class="rank">#${i+1}</span> <span>${data.username}</span> <span>${data.points} pts</span></div>`;
      });
    }

    function startCountdown() {
      const launch = new Date('2026-01-01T00:00:00+05:30');
      setInterval(() => {
        const diff = launch - new Date();
        if (diff <= 0) { document.getElementById('countdown').innerHTML = "<b>AIRDROPS LIVE!</b>"; return; }
        const d = Math.floor(diff / 86400000);
        const h = Math.floor((diff % 86400000) / 3600000);
        const m = Math.floor((diff % 3600000) / 60000);
        document.getElementById('countdown').innerHTML = `<b>Time: ${d}d ${h}h ${m}m to Airdrop</b>`;
      }, 1000);
    }

    function updateUI() {
      document.getElementById('points').innerText = Math.floor(current.points);
      document.getElementById('speed').innerText = current.speed;
      document.getElementById('refs').innerText = current.refs.length;
      document.getElementById('ref-count').innerText = current.refs.length;
      document.getElementById('ads-today').innerText = current.adsToday;
      document.getElementById('ads-limit').innerText = 100 + current.refs.length * 2;
    }

    function openTab(tab) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.getElementById(tab).classList.add('active');
      document.querySelector(`[onclick="openTab('${tab}')"]`).classList.add('active');
      if (tab === 'referral') loadLeaderboard();
    }

    initUser();
  </script>
</body>
        </html>
